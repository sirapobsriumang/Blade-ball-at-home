<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Player vs Bot Deflect Game</title>
  <style>
    canvas {
      background: #111;
      display: block;
      margin: 0 auto;
      border: 2px solid white;
    }
    body {
      color: white;
      text-align: center;
      font-family: Arial, sans-serif;
    }
    button {
      padding: 10px 15px;
      font-size: 16px;
      margin: 5px;
      cursor: pointer;
    }
    #mobile-controls {
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h1>Player vs Bot Deflect Game</h1>
  <p>Use A/D keys, W key, or mobile buttons to move. Click "Deflect" or use Auto Parry!</p>
  <p id="info">Score: 0 | Health: 3</p>
  <canvas id="game" width="600" height="400"></canvas>

  <div>
    <button id="deflectBtn">Deflect</button>
    <button id="toggleAutoParry">Enable Auto Parry</button>
  </div>
  
  <div id="mobile-controls">
    <button id="moveLeft">Left</button>
    <button id="moveRight">Right</button>
    <button id="moveForward">Forward</button>
  </div>

  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");
    const info = document.getElementById("info");
    const deflectBtn = document.getElementById("deflectBtn");
    const toggleAutoParry = document.getElementById("toggleAutoParry");
    const moveLeft = document.getElementById("moveLeft");
    const moveRight = document.getElementById("moveRight");
    const moveForward = document.getElementById("moveForward");

    const player = { x: 300, y: 350, width: 40, height: 40, speed: 5 };
    const bot = { x: 300, y: 10, width: 40, height: 40, speed: 3, originalX: 300 };
    const ball = { x: 300, y: 200, radius: 15, speedX: 0, speedY: 3, active: true };

    let keys = {};
    let autoParry = false;
    let deflectWindow = false;
    let gameOver = false;
    let health = 3;
    let score = 0;

    deflectBtn.disabled = true;

    toggleAutoParry.addEventListener("click", () => {
      autoParry = !autoParry;
      toggleAutoParry.textContent = autoParry ? "Disable Auto Parry" : "Enable Auto Parry";
    });

    deflectBtn.addEventListener("click", () => {
      if (deflectWindow && ball.active) {
        ball.speedY *= -1; // Ball bounces off vertically
        ball.speedX = Math.random() > 0.5 ? 3 : -3; // Random horizontal speed
        deflectWindow = false;
        deflectBtn.disabled = true;
        score++;
        updateInfo();
      }
    });

    document.addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
    document.addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);

    let moveLeftPressed = false;
    let moveRightPressed = false;
    let moveForwardPressed = false;

    moveLeft.addEventListener("touchstart", () => moveLeftPressed = true);
    moveLeft.addEventListener("touchend", () => moveLeftPressed = false);
    moveRight.addEventListener("touchstart", () => moveRightPressed = true);
    moveRight.addEventListener("touchend", () => moveRightPressed = false);
    moveForward.addEventListener("touchstart", () => moveForwardPressed = true);
    moveForward.addEventListener("touchend", () => moveForwardPressed = false);

    function updateInfo() {
      info.textContent = `Score: ${score} | Health: ${health}`;
    }

    function resetBall() {
      ball.y = 200;
      ball.x = Math.random() * 500 + 50;
      ball.speedY = 3 * (Math.random() > 0.5 ? 1 : -1);
      ball.speedX = 0;
      deflectWindow = false;
      deflectBtn.disabled = true;
    }

    function update() {
      if (gameOver) return;

      if (keys["a"] || keys["arrowleft"] || moveLeftPressed) player.x -= player.speed;
      if (keys["d"] || keys["arrowright"] || moveRightPressed) player.x += player.speed;
      if (keys["w"] || moveForwardPressed) player.y -= player.speed;

      player.x = Math.max(0, Math.min(canvas.width - player.width, player.x));
      player.y = Math.max(0, Math.min(canvas.height - player.height, player.y));

      if (ball.active) {
        const ballSpeed = 3;
        const followSpeed = 5; // Speed at which the ball follows the player

        // Ball follows player horizontally
        if (ball.x < player.x) {
          ball.speedX = ballSpeed;
        } else if (ball.x > player.x) {
          ball.speedX = -ballSpeed;
        }

        // Ball follows player vertically with a delay effect
        if (ball.y < player.y) {
          ball.speedY = Math.abs(ball.speedY);
        } else {
          ball.speedY = -Math.abs(ball.speedY);
        }

        // Adjusting speed of ball follow direction
        if (ball.x !== player.x) {
          ball.x += ball.speedX * followSpeed / 10;
        }
        if (ball.y !== player.y) {
          ball.y += ball.speedY * followSpeed / 10;
        }
      }

      if (bot.x + bot.width / 2 < player.x) bot.x += bot.speed;
      else if (bot.x + bot.width / 2 > player.x) bot.x -= bot.speed;
      bot.x = Math.max(0, Math.min(canvas.width - bot.width, bot.x));

      // Ball collision with player to trigger deflection
      if (
        ball.speedY > 0 &&
        ball.y + ball.radius >= player.y &&
        ball.y <= player.y + player.height &&
        ball.x > player.x &&
        ball.x < player.x + player.width
      ) {
        deflectWindow = true;
        deflectBtn.disabled = false;
      }

      // Ball collision with bot
      if (
        ball.speedY < 0 &&
        ball.y - ball.radius <= bot.y + bot.height &&
        ball.y >= bot.y &&
        ball.x > bot.x &&
        ball.x < bot.x + bot.width
      ) {
        ball.speedY *= -1;
        score++;
        updateInfo();
      }

      if (ball.y > canvas.height) {
        health--;
        updateInfo();
        if (health <= 0) {
          gameOver = true;
          alert("You lost! Final Score: " + score);
        }
        resetBall();
      }

      if (ball.y < 0) {
        ball.speedY *= -1;
        bot.x = bot.originalX;
      }
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      ctx.fillStyle = "cyan";
      ctx.fillRect(player.x, player.y, player.width, player.height);

      ctx.fillStyle = "lime";
      ctx.fillRect(bot.x, bot.y, bot.width, bot.height);

      ctx.beginPath();
      ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
      ctx.fillStyle = "red";
      ctx.fill();
    }

    function gameLoop() {
      update();
      draw();
      if (!gameOver) requestAnimationFrame(gameLoop);
    }

    updateInfo();
    gameLoop();
  </script>
</body>
</html>
